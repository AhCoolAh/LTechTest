//
//  MainMenuPresenter.swift
//  LTechTest
//
//  Created by Pavel21 on 12.11.2022.
//  Copyright (c) 2022 ___ORGANIZATIONNAME___. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit
import SwiftyJSON

protocol MainMenuPresentationLogic {
    func presentLoadedData(data: JSON)
    func presentSortedData(array: [MainMenu.CellData.CellData], sort:MainMenu.Sort.Sort)
}

class MainMenuPresenter: MainMenuPresentationLogic {
    weak var viewController: MainMenuDisplayLogic?
    

    // MARK: Parse and calc respnse from MainMenuInteractor and send simple view model to MainMenuViewController to be displayed

    func presentLoadedData(data: JSON) {
        var cellData = [MainMenu.CellData.CellData]()
        data.forEach { item in
            
            let id = item.1["id"].stringValue
            let title = item.1["title"].stringValue
            let text = item.1["text"].stringValue
            let image = item.1["image"].stringValue
            let sort = item.1["sort"].intValue
            let dateRaw = item.1["date"].stringValue
            
            let dateFormatter = DateFormatter()
            dateFormatter.dateFormat = "yy-MM-dd'T'HH:mm:ssZ"
            let dateFormatterString = DateFormatter()
            dateFormatterString.dateFormat = "dd MMMM, HH:mm"
            
            let date = dateFormatter.date(from: dateRaw)!
            let stringDate = dateFormatterString.string(from: date)

            let data = MainMenu.CellData.CellData(id: id, title: title, text: text, image: image, sort: sort, date: date, stringDate: stringDate)
            cellData.append(data)
        }
        viewController?.displayLoadedData(array: cellData)
    }
    
    func presentSortedData(array: [MainMenu.CellData.CellData], sort:MainMenu.Sort.Sort) {
        if sort.isSortedByDate {
            viewController?.displaySortedData(array: array.sorted(by: { $0.date > $1.date }))
        } else {
            viewController?.displaySortedData(array: array.sorted(by: { $0.sort < $1.sort }))
        }
    }
}
